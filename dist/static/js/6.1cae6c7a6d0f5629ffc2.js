webpackJsonp([6],{jPr8:function(t,e){},lmGy:function(t,e,a){"use strict";var i=a("Xxa5"),s=a.n(i),r=a("exGp"),o=a.n(r),n=a("ikD4"),l={props:{objInputs:{type:Object,required:!0},resourceName:{type:String,required:!0},itemSelected:{type:Array,required:!1}},data:function(){return{local:{data:[],filteredTags:[],isSelectOnly:!1,tags:[],maxDefault:this.maxtags||20}}},computed:{},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;return o()(s.a.mark(function e(){var a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.resourceName,e.next=3,n.a.getResource({resourceName:a,queryString:[t.BUILDPARAM({type:"selection"})]});case 3:i=e.sent,t.local.data=i.data,t.getFilterResult();case 6:case"end":return e.stop()}},e,t)}))()},getFilteredTags:function(t){this.local.filteredTags=this.local.data.filter(function(e){return e.name.indexOf(t)>=0})},changeItems:function(){var t=[];this.local.tags.map(function(e){t.push(e.id)}),this.$emit("selected",t)},getFilterResult:function(){var t=this;if(null===this.itemSelected||void 0===this.itemSelected)return[];this.local.tags=this.local.data.filter(function(e){return t.itemSelected.includes(e.id)})}},watch:{itemSelected:function(){this.getFilterResult()}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",[a("b-dropdown",[a("button",{staticClass:"button",attrs:{slot:"trigger"},slot:"trigger"},[a("b-icon",{attrs:{icon:"list"}})],1),t._v(" "),a("section",[a("b-field",{attrs:{label:t.objInputs.label}},[a("b-taginput",{attrs:{maxtags:t.objInputs.maxtags,data:t.local.filteredTags,autocomplete:"",field:"name",icon:"search",placeholder:t.objInputs.placeholder},on:{add:t.changeItems,remove:t.changeItems,typing:t.getFilteredTags},scopedSlots:t._u([{key:"default",fn:function(e){return[a("strong",[t._v(t._s(e.option.name))])]}}]),model:{value:t.local.tags,callback:function(e){t.$set(t.local,"tags",e)},expression:"local.tags"}},[a("template",{slot:"empty"},[t._v("\n                  ไม่พบข้อมูล\n              ")])],2)],1)],1)])],1)},staticRenderFns:[]};var d=a("VU/8")(l,c,!1,function(t){a("jPr8")},"data-v-8c4086f6",null);e.a=d.exports},mH6X:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Xxa5"),s=a.n(i),r=a("exGp"),o=a.n(r),n=a("ujS/"),l=a("ikD4"),c=a("kVPM"),d=a("7Dwl"),u=a("7x59"),m=a("lmGy"),p=a("Tdo9"),v={props:{},components:{breadcrumbBar:n.a,myInput:d.a,myAction:u.a,myTagsSelection:m.a,myAutoComplete:p.a},name:"EditWorkOrderPage",data:function(){return{local:{pageObj:{items:[{name:"ลำดับการทำงาน",route:"Workorder",key:"",active:!1,icon:"fa fa-tasks"},{name:"แก้ไข",route:"EditWorkorder",key:this.$route.params.key,active:!0,icon:""}],template:{class:"edit-work-order-page"}},time:null,project:{},workOrderTemplate:{time:this.time,preOrder:[],lists:[{order:"",taskName:"",postOrder:[]}]},itemPreOrder:null,itemLists:[],materialGroup:{mainSearch:""},houseTemplate:{inputs:[],selected:null}}}},computed:{resourceName:function(){return c.a.api.workOrder.index},materialGroupResource:function(){return c.a.api.materialGroup.index}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;return o()(s.a.mark(function e(){var a,i,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.next=3,l.a.getResource({resourceName:c.a.api.house.dropdown,queryString:a});case 3:i=e.sent,t.local.houseTemplate.inputs=i.data,r=c.a.api.workOrder.index+"/"+t.$route.params.key,a=t.BUILDPARAM({type:"full"}),l.a.getResource({resourceName:r,queryString:a}).then(function(e){e.data?(t.local.time=e.data.time,t.local.project=e.data.project,t.local.itemLists=e.data.lists.map(function(t){return{order:t.order,taskName:t.name,postOrder:[t.post_order],condition:t.condition}})):t.local.item.push(t.local.workOrderTemplate)}).catch(function(){});case 8:case"end":return e.stop()}},e,t)}))()},editRow:function(t){"add"===t?this.local.itemLists.push({order:this.local.itemLists.length+1,taskName:"",postOrder:[]}):this.local.itemLists.pop()},deleteTime:function(t){this.local.itemLists.splice(t,1)},submitForm:function(t){var e=this;return o()(s.a.mark(function a(){var i,r,o,n,c;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$validator.validateAll();case 2:i=a.sent,r=e.resourceName,o={},n=null,a.t0=t,a.next="update"===a.t0?9:"delete"===a.t0?17:23;break;case 9:if(i){a.next=11;break}return a.abrupt("return");case 11:return o={workOrderLists:e.local.itemLists},r=r+"/"+e.$route.params.key,a.next=15,l.a.putResource({data:o,resourceName:r});case 15:return n=a.sent,a.abrupt("break",23);case 17:return r=r+"/"+e.$route.params.key,c=[],a.next=21,l.a.deleteResource({resourceName:r,queryString:c});case 21:return n=a.sent,a.abrupt("break",23);case 23:if(200!==n.status){a.next=27;break}return e.fetchData(),e.NOTIFY("success"),a.abrupt("return");case 27:e.NOTIFY("error");case 28:case"end":return a.stop()}},a,e)}))()},houseSelectedHandle:function(t){null!==t&&(this.local.houseTemplate.selected=t.key)},setCondition:function(t,e,a,i){var s=this.local.houseTemplate.selected,r=!1;if(void 0!==this.local.itemLists[t].condition&&this.local.itemLists[t].condition.map(function(t){t.house_id===s&&(r=!0,t[a]=e)}),!r){this.local.itemLists[t].condition=[];var o={house_id:s,order:i.order,preiod:null,preiod_end:null,condition:null};o[a]=e,this.local.itemLists[t].condition.push(o)}},getCondition:function(t,e){var a=this;if(null===this.local.houseTemplate.selected||void 0===t)return"";var i=t.filter(function(t){return t.house_id===a.local.houseTemplate.selected})[0];return void 0===i?"":i[e]}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{class:["section",t.local.pageObj.template.class]},[a("breadcrumb-bar",{attrs:{dataObj:t.local.pageObj}}),t._v(" "),a("div",{staticClass:"container-block"},[a("div",{staticClass:"detail-panel"},[[a("div",{staticClass:"container-block detail-block"},[a("div",{staticClass:"c-body"},[a("div",{staticClass:"items"},[a("div",{staticClass:"item"},[a("div",{staticClass:"item-header container-block"},[a("div",{staticClass:"time block"},[a("div",{staticClass:"control"},[a("div",{staticClass:"tags has-addons"},[a("span",{staticClass:"is-medium tag is-info"},[t._v(t._s(this.local.project.name))]),t._v(" "),a("span",{staticClass:"is-medium tag"},[t._v("งวดที่ "+t._s(t.local.time))])])])]),t._v(" "),a("div",{staticClass:"order-name container-block block"},[a("span",{staticClass:"name"},[t._v("แบบบ้าน")]),t._v(" "),a("my-auto-complete",{attrs:{config:{getNullVal:!1},arrInputs:t.local.houseTemplate.inputs,placeholder:"ค้นหาแบบบ้าน",label:""},on:{select:t.houseSelectedHandle}})],1)]),t._v(" "),null!==t.local.houseTemplate.selected?a("div",{staticClass:"item-body"},[a("table",[t._m(0),t._v(" "),a("tbody",t._l(t.local.itemLists,function(e,i){return a("tr",{key:i},[a("td",{key:t.local.houseTemplate.selected+"ItemOrder"},[t._v("\n                          "+t._s(e.order)+"\n                        ")]),t._v(" "),a("td",{key:t.local.houseTemplate.selected+"ItemName"},[a("my-input",{attrs:{value:e.taskName,inputObj:{type:"text",name:"order_group_"+i,placeholder:"ระบุรายละเอียดงาน",validate:"required"},validator:t.$validator},on:{input:function(t){e.taskName=t}}})],1),t._v(" "),a("td",{key:t.local.houseTemplate.selected+"ItemCondition"},[a("my-input",{attrs:{value:t.getCondition(e.condition,"condition"),inputObj:{type:"text",name:"order_condition_"+i,placeholder:"",validate:""},validator:t.$validator},on:{input:function(a){return t.setCondition(i,a,"condition",e)}}})],1),t._v(" "),a("td",{key:t.local.houseTemplate.selected+"ItemPreiod"},[a("my-input",{attrs:{value:t.getCondition(e.condition,"preiod"),inputObj:{type:"text",name:"order_preiod_"+i,placeholder:"",validate:"required"},validator:t.$validator},on:{input:function(a){return t.setCondition(i,a,"preiod",e)}}})],1),t._v(" "),a("td",{key:t.local.houseTemplate.selected+"ItemPreiodEnd"},[a("my-input",{attrs:{value:t.getCondition(e.condition,"preiod_end"),inputObj:{type:"text",name:"order_preiod_end_"+i,placeholder:"",validate:"required"},validator:t.$validator},on:{input:function(a){return t.setCondition(i,a,"preiod_end",e)}}})],1),t._v(" "),a("td",{key:t.local.houseTemplate.selected+"ItemMaterialGroup"},[a("my-tags-selection",{attrs:{objInputs:{label:"เลือกกลุ่มวัสดุ",placeholder:"เพิ่มกลุ่มวัสดุ",maxtags:"1"},resourceName:t.materialGroupResource,itemSelected:e.postOrder},on:{selected:function(t){e.postOrder=t}}})],1),t._v(" "),a("td",{key:t.local.houseTemplate.selected+"ItemDelete"},[a("button",{staticClass:"button is-danger",on:{click:function(e){t.deleteTime(i)}}},[a("i",{staticClass:"fa fa-trash"})])])])}))])]):t._e(),t._v(" "),null!==t.local.houseTemplate.selected?a("div",{staticClass:"item-footer container-block"},[a("div",{staticClass:"container-block block right"},[a("button",{staticClass:"button",on:{click:function(e){t.editRow("add")}}},[a("i",{staticClass:"fa fa-plus",attrs:{"aria-hidden":"true"}})])]),t._v(" "),a("div",{staticClass:"container-block block action"},[a("my-action",{attrs:{type:"update",obj:{title:"บันทึกข้อมูลงวดที่ "+t.local.time}},on:{clickEvent:function(e){t.submitForm("update")}}})],1)]):t._e()])])])])]],2)])],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("td",[t._v("#")]),t._v(" "),a("td",[t._v("รายละเอียดงาน")]),t._v(" "),a("td",{attrs:{width:"80"}},[t._v("เงื่อนไขการเริ่ม")]),t._v(" "),a("td",{attrs:{width:"80"}},[t._v("ระยะเวลา (ก่อน)")]),t._v(" "),a("td",{attrs:{width:"80"}},[t._v("ระยะเวลา (หลัง)")]),t._v(" "),a("td",{attrs:{width:"50"}}),t._v(" "),a("td",{attrs:{width:"50"}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-block empty-panel"},[a("div",{staticClass:"block container-block"},[a("div",{staticClass:"block no-data"},[t._v("\n                  ไม่พบข้อมูลที่ต้องการ\n              ")]),t._v(" "),a("div",{staticClass:"block select-data"},[a("i",{staticClass:"fa fa-hand-o-left",attrs:{"aria-hidden":"true"}}),t._v(" "),a("span",[t._v("เลือกข้อมูลทางซ้ายมือเพื่อแสดง")])]),t._v(" "),a("div",{staticClass:"block or"},[t._v("\n                หรือ\n              ")]),t._v(" "),a("div",{staticClass:"block add-data"},[a("button",{staticClass:"button"},[t._v("เพิ่มข้อมูลใหม่")])])])])}]};var f=a("VU/8")(v,h,!1,function(t){a("sDRP")},null,null);e.default=f.exports},sDRP:function(t,e){}});
//# sourceMappingURL=6.1cae6c7a6d0f5629ffc2.js.map