webpackJsonp([18],{X8w4:function(t,e){},rXke:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("Xxa5"),n=a.n(l),s=a("exGp"),r=a.n(s),i=a("ujS/"),u=a("O/8C"),o=a("KxLu"),c=a("ikD4"),d=a("kVPM"),p=a("Y3eR"),m=a("7Dwl"),b=a("7x59"),f=a("Tdo9"),h={props:{},components:{breadcrumbBar:i.a,optionDetailTemplate:u.a,noResultTemplate:o.a,dataTable:p.a,myInput:m.a,myAction:b.a,myAutoComplete:f.a},name:"OrderingGroup",data:function(){return{local:{pageObj:{items:[{name:"กลุ่มวัสดุ",route:"OrderingGroup",key:"xxx",active:!0,icon:"fa fa-folder-open-o"}],template:{class:"ordering-group-page"}},statusSearch:[],idSelected:"",inputs:{id:null,name:null,houseId:null,lists:[]},lists:[],materials:{},materialMainSearch:"",materialStatusSelected:"",houseTemplate:{inputs:[],selected:null}}}},computed:{resourceName:function(){return d.a.api.materialGroup.index}},updated:function(){},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;return r()(n.a.mark(function e(){var a,l;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.BUILDPARAM(),e.next=3,c.a.getResource({resourceName:d.a.api.house.dropdown,queryString:a});case 3:l=e.sent,t.local.houseTemplate.inputs=l.data;case 5:case"end":return e.stop()}},e,t)}))()},houseSelectedHandle:function(t){null!==t?(this.local.houseTemplate.selected=t,this.local.inputs.houseId=t.key,this.local.inputs.lists=this.local.lists.filter(function(e){return e.houseId===t.key})):this.local.inputs.lists=this.local.lists},selectedDataHandle:function(t){this.local.idSelected=t.id,this.local.inputs.id=t.id,this.local.inputs.name=t.name,this.local.inputs.lists=t.detail.map(function(t){return{materialId:t.material_id,amount:t.amount,houseId:t.house_id,materialName:t.name}}),this.local.lists=this.local.inputs.lists},deleteListsItem:function(t){this.local.inputs.lists.splice(t,1)},cleanInput:function(){this.local.idSelected=null,this.local.inputs.id=null,this.local.inputs.name=null,this.local.inputs.lists=[]},submitForm:function(t){var e=this;return r()(n.a.mark(function a(){var l,s,r,i,u;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$validator.validateAll();case 2:l=a.sent,s=e.resourceName,"update"===t&&"new"===e.local.idSelected&&(t="save"),r={},i=null,a.t0=t,a.next="add"===a.t0?10:"cancel"===a.t0?13:"update"===a.t0?15:"delete"===a.t0?23:"save"===a.t0?29:36;break;case 10:return e.cleanInput(),e.local.idSelected="new",a.abrupt("return");case 13:return e.cleanInput(),a.abrupt("return");case 15:if(l){a.next=17;break}return a.abrupt("return");case 17:return r=e.local.inputs,s=s+"/"+e.local.idSelected,a.next=21,c.a.putResource({data:r,resourceName:s});case 21:return i=a.sent,a.abrupt("break",36);case 23:return s=s+"/"+e.local.idSelected,u=[],a.next=27,c.a.deleteResource({resourceName:s,queryString:u});case 27:return i=a.sent,a.abrupt("break",36);case 29:if(l){a.next=31;break}return a.abrupt("return");case 31:return r=e.local.inputs,a.next=34,c.a.postResource({data:r,resourceName:s});case 34:return i=a.sent,a.abrupt("break",36);case 36:if(200!==i.status){a.next=42;break}return e.reloadTable(),e.cleanInput(),e.local.idSelected="",e.NOTIFY("success"),a.abrupt("return");case 42:e.NOTIFY("error");case 43:case"end":return a.stop()}},a,e)}))()},reloadTable:function(){this.$refs.dataTable.fetchData()},itemSelectedHandle:function(){}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("option-detail-template",{ref:"template",attrs:{isSelected:t.local.idSelected,templateObj:t.local.pageObj.template},on:{cancleForm:function(e){t.submitForm("cancel")}}},[a("template",{slot:"title"},[a("breadcrumb-bar",{attrs:{dataObj:t.local.pageObj}})],1),t._v(" "),a("template",{slot:"data-table"},[a("data-table",{ref:"dataTable",attrs:{tableType:"normal",resourceName:t.resourceName,statusSearch:t.local.statusSearch},on:{selectedData:t.selectedDataHandle}})],1),t._v(" "),a("template",{slot:"function"},[a("button",{staticClass:"button is-link",on:{click:function(e){t.submitForm("add")}}},[t._v("เพิ่มข้อมูลใหม่")])]),t._v(" "),t.local.idSelected?[a("template",{slot:"detail"},[a("div",{staticClass:"container-block detail-block"},[a("div",{staticClass:"block result"},[a("div",{staticClass:"title-name"},[a("div",{staticClass:"label"},[t._v("กลุ่มวัสดุ")]),t._v(" "),a("my-input",{attrs:{value:t.local.inputs.name,inputObj:{type:"text",name:"order_group",placeholder:"ชื่อกลุ่มวัสดุ",validate:"required"},validator:t.$validator},on:{input:function(e){t.local.inputs.name=e}}})],1),t._v(" "),a("div",{staticClass:"items"},[a("table",{staticClass:"transparent-table"},[a("thead",[a("tr",[a("td",{attrs:{width:"200"}},[a("my-auto-complete",{attrs:{arrInputs:t.local.houseTemplate.inputs,placeholder:"ค้นหาแบบบ้าน",label:""},on:{select:t.houseSelectedHandle}})],1),t._v(" "),a("td",[t._v("รายการ")]),t._v(" "),a("td",{attrs:{width:"40"}},[t._v("จำนวน")]),t._v(" "),a("td")])]),t._v(" "),t.local.inputs.lists.length?a("tbody",t._l(t.local.inputs.lists,function(e,l){return a("tr",{key:l},[a("td",[t._v(t._s(e.houseId))]),t._v(" "),a("td",[t._v(t._s(e.materialName))]),t._v(" "),a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.amount,expression:"item.amount"}],staticClass:"input",attrs:{type:"number",size:"2"},domProps:{value:e.amount},on:{input:function(a){a.target.composing||t.$set(e,"amount",a.target.value)}}})]),t._v(" "),a("td",[a("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"},on:{click:function(e){t.deleteListsItem(l)}}})])])})):t._e()])])])]),t._v(" "),a("div",{staticClass:"container-block footer-panel"},[a("my-action",{attrs:{type:"update",obj:{title:"บันทึกข้อมูล"}},on:{clickEvent:function(e){t.submitForm("update")}}}),t._v(" "),a("my-action",{attrs:{type:"delete",obj:{title:"ลบข้อมูล"}},on:{clickEvent:function(e){t.submitForm("delete")}}})],1)])]:a("template",{slot:"detail"},[a("no-result-template")],1)],2)},staticRenderFns:[]};var _=a("VU/8")(h,v,!1,function(t){a("X8w4")},null,null);e.default=_.exports}});
//# sourceMappingURL=18.5e8406d4ad7096407a1d.js.map