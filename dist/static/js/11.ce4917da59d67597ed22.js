webpackJsonp([11],{LaDk:function(t,e){},VOtH:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Xxa5"),n=a.n(s),c=a("exGp"),r=a.n(c),i=a("NHnr"),o=a("ujS/"),l=a("O/8C"),u=a("kVPM"),d=a("ikD4"),p=a("Y3eR"),v=a("7x59"),_=a("7Dwl"),m=a("Tdo9"),h=a("STNA"),f={props:{},components:{breadcrumbBar:o.a,optionDetailTemplate:l.a,dataTable:p.a,myAction:v.a,myInput:_.a,myAutoComplete:m.a,contractSerach:h.a},name:"ContractPage",data:function(){return{local:{pageObj:{items:[{name:"ข้อมูลสัญญา",route:"Contract",key:"test",active:!0,icon:"fa fa-file-text"}],template:{class:"contract-page"}},statusSearch:[{title:"ทั้งหมด",key:""},{title:"เสร็จสิ้น",key:"done"},{title:"รออนุมัติ",key:"wait"},{title:"ดำเนินการ",key:"ip"}],idSelected:null,inputs:{project:{},contractTime:{},contract:{},progress:null},technician:{inputs:[],selected:null}}}},computed:{resourceName:function(){return u.a.api.contract.index}},created:function(){this.getTechnicianData()},mounted:function(){void 0!==this.$route.params.key&&"all"!==this.$route.params.key&&this.$refs.dataTable.searchByText({value:this.$route.params.key})},methods:{getTechnicianData:function(){var t=this;return r()(n.a.mark(function e(){var a,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.BUILDPARAM({type:"technician"}),e.next=3,d.a.getResource({resourceName:u.a.api.users.dropdown,queryString:a});case 3:s=e.sent,t.local.technician.inputs=s.data;case 5:case"end":return e.stop()}},e,t)}))()},contractSelectedHandle:function(t){var e=this;return r()(n.a.mark(function a(){var s,c;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return null===t&&e.cleanInput(),e.local.idSelected=t.code,s=e.BUILDPARAM({type:"full"}),a.next=5,d.a.getResource({resourceName:u.a.api.contract.index+"/"+t.code,queryString:s});case 5:c=a.sent,e.local.inputs.project=c.data.project,e.local.inputs.contract=c.data.contract,e.local.inputs.contractTime=c.data.contractTime,e.local.inputs.progress=c.data.progress,e.local.inputs.contract.assign?e.local.technician.selected=e.local.inputs.contract.assign:e.local.technician.selected="";case 11:case"end":return a.stop()}},a,e)}))()},cleanInput:function(){this.local.idSelected=null,this.local.inputs.project={},this.local.inputs.contractTime={},this.local.inputs.contract={},this.local.inputs.progress=null},updateContractTime:function(t,e){var a=this;return r()(n.a.mark(function s(){var c,r,i;return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return c="time_"+e,r={isSuccess:a.$refs[c][0].checked},i=u.a.api.contract.time+"/"+t,s.next=5,d.a.putResource({data:r,resourceName:i});case 5:200===s.sent.status?a.NOTIFY("success"):a.NOTIFY("error");case 7:case"end":return s.stop()}},s,a)}))()},submitForm:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r()(n.a.mark(function s(){var c,r,o,l,p;return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.$validator.validateAll();case 2:c=s.sent,r=e.resourceName,o={},l=null,s.t0=t,s.next="add"===s.t0?9:"cancel"===s.t0?10:"updateStatus"===s.t0?12:"updateProgress"===s.t0?24:"save"===s.t0?31:32;break;case 9:return s.abrupt("return");case 10:return e.local.idSelected=null,s.abrupt("return");case 12:if(c){s.next=14;break}return s.abrupt("return");case 14:return o.status=a,o.assign=e.local.technician.selected,o.houseId=e.local.inputs.contract.house_id,r=u.a.api.contract.status+"/"+e.local.idSelected,s.next=20,d.a.putResource({data:o,resourceName:r});case 20:return l=s.sent,p=l.data.orderingData,i.bus.$emit("setNotification",{type:"ordering",value:p}),s.abrupt("break",32);case 24:return r=u.a.api.contract.progress+"/"+e.local.idSelected,o.progress=e.local.inputs.progress,o.assign=e.local.technician.selected,s.next=29,d.a.putResource({data:o,resourceName:r});case 29:return l=s.sent,s.abrupt("break",32);case 31:return s.abrupt("break",32);case 32:if(200!==l.status){s.next=35;break}return e.NOTIFY("success"),s.abrupt("return");case 35:e.NOTIFY("error");case 36:case"end":return s.stop()}},s,e)}))()},getWorkingStatus:function(t){return u.a.variable.workingStatus[t]},getDateFromContract:function(t){return void 0!==this.local.inputs.contractTime[0]?this.SET_DATEFORMAT(this.local.inputs.contractTime[t-1].date_start):null},setRealDate:function(t,e){var a=this.SET_DATEFORMAT(t),s=this.GET_DATEDIFF(this.local.inputs.progress[e].end_date,a);isNaN(s)&&(s=0),this.local.inputs.progress[e].delay=Math.ceil(s),this.local.inputs.progress[e].real_date=t},getStatusClass:function(t){return["tag",{"is-white":"wait"===t},{"is-warning":"ip"===t},{"is-success":"done"===t}]},getDelayClass:function(t,e){return["tag",{"is-success":t<=0&&"done"===e},{"is-danger":t>0&&"done"===e}]},resetContract:function(){var t=this;return r()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.getResource({resourceName:u.a.api.contract.reset+"/"+t.local.idSelected,queryString:[]});case 2:200===e.sent.status&&t.NOTIFY("success");case 4:case"end":return e.stop()}},e,t)}))()},getTechnicianName:function(){var t=this;return this.local.technician.inputs.filter(function(e){return e.key===t.local.technician.selected})[0].name}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("option-detail-template",{attrs:{templateObj:t.local.pageObj.template,isSelected:t.local.idSelected},on:{cancleForm:function(e){t.submitForm("cancel")}}},[a("template",{slot:"title"},[a("breadcrumb-bar",{attrs:{dataObj:t.local.pageObj}})],1),t._v(" "),a("template",{slot:"data-table"},[a("contract-serach",{on:{select:t.contractSelectedHandle}})],1),t._v(" "),t.local.idSelected?[a("template",{slot:"detail"},[a("div",{staticClass:"container-block  detail-block"},[a("span",{staticClass:"type tag"},[t._v(t._s(t.GET_WORKSTATUS(t.local.inputs.contract.status)))]),t._v(" "),a("div",{staticClass:"block c-header"},[a("table",{staticClass:"transparent-table"},[a("tr",[a("td",[t._v("\n              โครงการ:"),a("span",{staticClass:"value is-linkpage",on:{click:function(e){t.GOTOPAGE("Project",t.local.inputs.project.name)}}},[t._v(t._s(t.local.inputs.project.name))])])]),t._v(" "),a("tr",[a("td",[t._v("เลขที่สัญญา:"),a("span",{staticClass:"value"},[t._v(t._s(t.local.inputs.contract.code))])]),t._v(" "),a("td",[t._v("แบบบ้าน:"),a("span",{staticClass:"value"},[t._v(t._s(t.local.inputs.contract.house_id))])])]),t._v(" "),a("tr",[a("td",[t._v("แปลง: "),a("span",{staticClass:"value"},[t._v(t._s(t.local.inputs.contract.contractPlan))])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("วันที่งวด 9 ตามส/ญ:"),a("span",{staticClass:"value"},[t._v(t._s(t.getDateFromContract(9)))])]),t._v(" "),a("td",[t._v("วันที่งวด 9 ตามปมก.:"),a("span",{staticClass:"value"},[t._v(t._s(t.getDateFromContract(9)))])])]),t._v(" "),a("tr",[a("td",[t._v("วันที่ End Prod.ตามส/ญ:"),a("span",{staticClass:"value"},[t._v(t._s(t.getDateFromContract(10)))])]),t._v(" "),a("td",[t._v("วันที่ทำสัญญา:"),a("span",{staticClass:"value"},[t._v(t._s(t.SET_DATEFORMAT(t.local.inputs.contract.date_start)))])])]),t._v(" "),a("tr",[a("td",[a("div",{staticClass:"container-block technician"},[a("div",{staticClass:"block title-name"},[t._v("ผู้รับมอบหมาย:")]),t._v(" "),a("div",{staticClass:"block"},["done"!==t.local.inputs.contract.status?a("my-input",{attrs:{value:t.local.technician.selected,inputObj:{type:"select",icon:"user",inputValue:t.local.technician.inputs,name:"technician",placeholder:"ผู้รับมอบหมาย",validate:"required"},validator:t.$validator},on:{input:function(e){t.local.technician.selected=e}}}):a("p",[t._v(t._s(t.getTechnicianName()))])],1)])]),t._v(" "),a("td")])])]),t._v(" "),a("div",{staticClass:"block c-body"},[a("table",{staticClass:"table rows-table is-hoverable"},[a("thead",[a("tr",[a("th",[t._v("งวด/ลำดับงาน")]),t._v(" "),a("th",[t._v("รายละเอียดงาน")]),t._v(" "),a("th",{attrs:{width:"120"}},[t._v("กำหนดเริ่มงาน")]),t._v(" "),a("th",{attrs:{width:"120"}},[t._v("กำหนดเสร็จงาน")]),t._v(" "),a("th",{attrs:{width:"120"}},[t._v("วันที่เสร็จจริง")]),t._v(" "),a("th",{attrs:{width:"50"}},[t._v("delay")]),t._v(" "),a("th",[t._v("สถานะ")])])]),t._v(" "),a("tbody",t._l(t.local.inputs.progress,function(e,s){return a("tr",{key:s},[a("td",[t._v(t._s(e.time)+"/"+t._s(e.order))]),t._v(" "),a("td",[t._v(t._s(e.name))]),t._v(" "),a("td",[t._v("\n                  "+t._s(t.SET_DATEFORMAT(e.start_date))+"\n                ")]),t._v(" "),a("td",[t._v(t._s(t.SET_DATEFORMAT(e.end_date)))]),t._v(" "),a("td",["ip"==t.local.inputs.contract.status&&null!==e.condition?a("my-input",{attrs:{value:t.SET_DATEFORMAT(e.real_date),inputObj:{type:"text",isBlur:!0,name:"contract_datestart",placeholder:"YYYY/MM/DD",validate:""},validator:t.$validator},on:{onBlur:function(e){return t.setRealDate(e,s)}}}):a("p",[t._v(t._s(t.SET_DATEFORMAT(e.real_date)))])],1),t._v(" "),a("td",[null!==e.condition?a("span",{class:t.getDelayClass(e.delay,e.status)},[t._v(t._s(e.delay))]):t._e()]),t._v(" "),a("td",[a("span",{class:t.getStatusClass(e.status)},[t._v(t._s(t.getWorkingStatus(e.status)))])])])}))])]),t._v(" "),"ip"==t.local.inputs.contract.status?a("div",{staticClass:"block c-extend"},[a("div",{staticClass:"container-block period"},t._l(t.local.inputs.contractTime,function(e,s){return a("div",{key:s,staticClass:"block container-block"},[a("label",{staticClass:"checkbox"},[a("input",{ref:"time_"+e.time,refInFor:!0,attrs:{type:"checkbox"},domProps:{checked:e.is_success},on:{change:function(a){t.updateContractTime(e.id,e.time)}}}),t._v("\n                งวดที่ "+t._s(e.time)+"\n              ")])])}))]):t._e()]),t._v(" "),"done"!==t.local.inputs.contract.status?a("div",{staticClass:"container-block footer-panel"},["wait"==t.local.inputs.contract.status?a("my-action",{attrs:{type:"updateStatus",obj:{title:"เริ่มดำเนินงาน (ทำสัญญาเสร็จสิ้น)",color:"is-warning",isConfirm:!0}},on:{clickEvent:function(e){t.submitForm("updateStatus","ip")}}}):t._e(),t._v(" "),"ip"==t.local.inputs.contract.status?a("my-action",{attrs:{type:"update",obj:{title:"ปิดงาน (เสร็จสิ้น)",color:"is-success",isConfirm:!0}},on:{clickEvent:function(e){t.submitForm("updateStatus","done")}}}):t._e(),t._v(" "),"ip"==t.local.inputs.contract.status?a("my-action",{attrs:{type:"update",obj:{title:"บันทึกข้อมูล",color:"is-info",isConfirm:!0}},on:{clickEvent:function(e){t.submitForm("updateProgress")}}}):t._e()],1):t._e()])]:t._e()],2)},staticRenderFns:[]};var g=a("VU/8")(f,b,!1,function(t){a("LaDk")},"data-v-797eae02",null);e.default=g.exports}});
//# sourceMappingURL=11.ce4917da59d67597ed22.js.map