webpackJsonp([12],{JPSK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Xxa5"),c=a.n(l),n=a("exGp"),i=a.n(n),r=a("ujS/"),s=a("O/8C"),o=a("KxLu"),u=a("ikD4"),d=a("kVPM"),p=a("Y3eR"),v=a("7Dwl"),m=a("7x59"),b={props:{},components:{breadcrumbBar:r.a,optionDetailTemplate:s.a,noResultTemplate:o.a,dataTable:p.a,myInput:v.a,myAction:m.a},name:"UserPage",data:function(){return{local:{pageObj:{items:[{name:"โครงการ",route:"Project",key:"xxx",active:!0,icon:"fa fa-folder-open-o"}],template:{class:"project-page"}},statusSearch:[{title:"ทั้งหมด",key:""},{title:"ดำเนินงาน",key:"ip"},{title:"เสร็จสิ้น",key:"done"}],idSelected:"",inputs:{},duplicate:{value:"",field:""},isDuplicate:!1}}},computed:{resourceName:function(){return d.a.api.project.index}},created:function(){},mounted:function(){void 0!==this.$route.params.key&&"all"!==this.$route.params.key&&this.$refs.dataTable.searchByText({value:this.$route.params.key})},methods:{selectedDataHandle:function(e){this.errors.clear(),this.local.idSelected=e.id,this.local.inputs.code=e.code,this.local.inputs.name=e.name,this.local.inputs.address=e.address,this.local.inputs.type=e.type,this.local.submitMode="update"},submitForm:function(e){var t=this;return i()(c.a.mark(function a(){var l,n,i,r,s;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$validator.validateAll();case 2:l=a.sent,n=t.resourceName,"update"===e&&"new"===t.local.idSelected&&(e="save"),i={},r=null,a.t0=e,a.next="add"===a.t0?10:"cancel"===a.t0?13:"update"===a.t0?15:"delete"===a.t0?23:"save"===a.t0?29:36;break;case 10:return t.local.idSelected="new",t.cleanInput(),a.abrupt("return");case 13:return t.local.idSelected=null,a.abrupt("return");case 15:if(l&&!t.local.isDuplicate){a.next=17;break}return a.abrupt("return");case 17:return i=t.local.inputs,n=n+"/"+t.local.idSelected,a.next=21,u.a.putResource({data:i,resourceName:n});case 21:return r=a.sent,a.abrupt("break",36);case 23:return n=n+"/"+t.local.idSelected,s=[],a.next=27,u.a.deleteResource({resourceName:n,queryString:s});case 27:return r=a.sent,a.abrupt("break",36);case 29:if(l&&!t.local.isDuplicate){a.next=31;break}return a.abrupt("return");case 31:return i=t.local.inputs,a.next=34,u.a.postResource({data:i,resourceName:n});case 34:return r=a.sent,a.abrupt("break",36);case 36:if(200!==r.status){a.next=42;break}return t.reloadTable(),t.cleanInput(),t.local.idSelected="",t.NOTIFY("success"),a.abrupt("return");case 42:t.NOTIFY("error");case 43:case"end":return a.stop()}},a,t)}))()},reloadTable:function(){this.$refs.dataTable.fetchData()},cleanInput:function(){this.local.inputs.code="",this.local.inputs.name="",this.local.inputs.address="",this.local.inputs.type=""},checkDuplicate:function(e,t){var a=this;return i()(c.a.mark(function l(){var n;return c.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(e){l.next=2;break}return l.abrupt("return");case 2:return n=a.BUILDPARAM({value:e,field:t,id:a.local.idSelected}),l.next=5,u.a.getResource({resourceName:d.a.api.project.checkDuplicate,queryString:n});case 5:if(!l.sent.data.length){l.next=10;break}return a.$refs["project_"+t].setDuplicate(),a.local.isDuplicate=!0,l.abrupt("return");case 10:a.local.isDuplicate=!1;case 11:case"end":return l.stop()}},l,a)}))()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("option-detail-template",{ref:"template",attrs:{templateObj:e.local.pageObj.template,isSelected:e.local.idSelected},on:{cancleForm:function(t){e.submitForm("cancel")}}},[a("template",{slot:"title"},[a("breadcrumb-bar",{attrs:{dataObj:e.local.pageObj}})],1),e._v(" "),a("template",{slot:"data-table"},[a("data-table",{ref:"dataTable",attrs:{tableType:"normal",resourceName:e.resourceName,statusSearch:e.local.statusSearch},on:{selectedData:e.selectedDataHandle}})],1),e._v(" "),a("template",{slot:"function"},[a("button",{staticClass:"button is-link",on:{click:function(t){e.submitForm("add")}}},[e._v("เพิ่มข้อมูลใหม่")])]),e._v(" "),""!=e.local.idSelected?[a("template",{slot:"detail"},[a("div",{staticClass:"container-block detail-block"},[a("div",{staticClass:"c-body"},[a("div",{staticClass:"form-detail"},[a("div",{staticClass:"name"},[e._v(e._s(e.local.inputs.code)+"  "+e._s(e.local.inputs.name))]),e._v(" "),a("div",{staticClass:"container-block"},[a("div",{staticClass:"text-title"},[e._v("รหัสโครงการ")]),e._v(" "),a("div",{staticClass:"value"},[a("my-input",{ref:"project_code",attrs:{value:e.local.inputs.code,inputObj:{type:"text",isBlur:!0,name:"project_code",placeholder:"รหัสโครงการ",validate:"required"},validator:e.$validator},on:{input:function(t){e.local.inputs.code=t},onBlur:function(t){e.checkDuplicate(e.local.inputs.code,"code")}}})],1)]),e._v(" "),a("div",{staticClass:"container-block"},[a("div",{staticClass:"text-title"},[e._v("ชื่อโครงการ")]),e._v(" "),a("div",{staticClass:"value"},[a("my-input",{ref:"project_name",attrs:{value:e.local.inputs.name,inputObj:{type:"text",name:"project_name",placeholder:"ชื่อโครงการ",validate:"required"},validator:e.$validator},on:{input:function(t){e.local.inputs.name=t}}})],1)]),e._v(" "),a("div",{staticClass:"container-block"},[a("div",{staticClass:"text-title"},[e._v("ที่ตั้ง")]),e._v(" "),a("div",{staticClass:"value"},[a("b-field",[a("b-input",{attrs:{type:"text",placeholder:"ที่ตั้ง"},model:{value:e.local.inputs.address,callback:function(t){e.$set(e.local.inputs,"address",t)},expression:"local.inputs.address"}})],1)],1)]),e._v(" "),a("div",{staticClass:"container-block"},[a("div",{staticClass:"text-title"},[e._v("ประเภท")]),e._v(" "),a("div",{staticClass:"value"},[a("my-input",{attrs:{value:e.local.inputs.type,inputObj:{type:"select",icon:"home",inputValue:e.PROJECT_TYPE,name:"project_type",placeholder:"",validate:"required"},validator:e.$validator},on:{input:function(t){e.local.inputs.type=t}}})],1)])])])]),e._v(" "),a("div",{staticClass:"container-block footer-panel"},[a("my-action",{attrs:{type:"update",obj:{title:"บันทึกข้อมูล"}},on:{clickEvent:function(t){e.submitForm("update")}}}),e._v(" "),"new"!=e.local.idSelected?a("my-action",{attrs:{type:"link",obj:{title:"สร้างสัญญาใหม่"}},on:{clickEvent:function(t){e.GOTOPAGE("CreateContract",e.local.idSelected)}}}):e._e(),e._v(" "),"new"!=e.local.idSelected?a("my-action",{attrs:{type:"delete",obj:{title:"ลบข้อมูล"}},on:{clickEvent:function(t){e.submitForm("delete")}}}):e._e()],1)])]:a("template",{slot:"detail"},[a("no-result-template")],1)],2)},staticRenderFns:[]};var k=a("VU/8")(b,f,!1,function(e){a("bPr+")},null,null);t.default=k.exports},"bPr+":function(e,t){}});
//# sourceMappingURL=12.26cfa710f36562be9b3c.js.map